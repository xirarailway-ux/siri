<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Files</title>
  <link rel="stylesheet" href="/public/css/style.css" />
</head>
<body>
  <header class="navbar">
    <div class="brand">TTS Admin</div>
    <nav>
      <a class="<%= nav==='dashboard'?'active':'' %>" href="/admin">Dashboard</a>
      <a class="<%= nav==='users'?'active':'' %>" href="/admin/users">Users</a>
      <a class="<%= nav==='payments'?'active':'' %>" href="/admin/payments">Payments</a>
      <a class="<%= nav==='voices'?'active':'' %>" href="/admin/voices">Voices</a>
      <a class="<%= nav==='plans'?'active':'' %>" href="/admin/plans">Plans</a>
      <a class="<%= nav==='files'?'active':'' %>" href="/admin/files">Files</a>
      <a class="<%= nav==='settings'?'active':'' %>" href="/admin/settings">Settings</a>
      <a href="/admin/logout">Logout</a>
    </nav>
  </header>
  <main class="container">
    <div class="card reveal">
      <div class="header-row">
        <h2 class="section-title">Files</h2>
        <span class="badge"><%= entries.length %> items</span>
      </div>
      <% if (error) { %><div class="error"><%= error %></div><% } %>
      <div class="actions" style="margin-bottom:8px">
        <div>
          Path:
          <% if (crumbs.length === 0) { %>
            <span>/</span>
          <% } %>
          <% let accum=''; crumbs.forEach((c,i)=>{ accum = accum ? (accum + '/' + c) : c; %>
            <a class="link" href="/admin/files?p=<%= accum %>"><%= c %></a><% if (i < crumbs.length-1) { %> / <% } %>
          <% }) %>
        </div>
        <form method="post" action="/admin/files/mkdir" class="inline">
          <input type="hidden" name="p" value="<%= rel %>" />
          <input class="input small" type="text" name="name" placeholder="New folder" />
          <button class="btn btn-outline">Create</button>
        </form>
        <form method="post" action="/admin/files/upload" enctype="multipart/form-data" class="inline">
          <input type="hidden" name="dest" value="<%= rel %>" />
          <input type="file" name="file" />
          <button class="btn btn-outline">Upload</button>
        </form>
      </div>
      <% if (fileContent !== undefined) { %>
        <div class="field">
          <span class="label"><%= fileName %></span>
          <form method="post" action="/admin/files/save">
            <input type="hidden" name="p" value="<%= rel %>" />
            <textarea class="input" name="content" rows="20"><%= fileContent %></textarea>
            <div class="actions" style="margin-top:8px"><button class="btn btn-primary">Save</button></div>
          </form>
        </div>
      <% } else { %>
        <table>
          <thead><tr><th>Name</th><th>Type</th><th>Size</th><th>Modified</th><th>Actions</th></tr></thead>
          <tbody>
            <% entries.forEach(e => { %>
              <tr>
                <td>
                  <% if (e.is_dir) { %>
                    <a class="link" href="/admin/files?p=<%= (rel ? (rel + '/' + e.name) : e.name) %>"><%= e.name %></a>
                  <% } else { %>
                    <a class="link" href="/admin/files/view?p=<%= (rel ? (rel + '/' + e.name) : e.name) %>"><%= e.name %></a>
                  <% } %>
                </td>
                <td><%= e.is_dir ? 'Folder' : 'File' %></td>
                <td><%= e.is_dir ? '-' : e.size %></td>
                <td><%= e.mtime %></td>
                <td class="table-actions">
                  <% if (!e.is_dir) { %>
                    <a class="btn btn-outline" href="/admin/files/download?p=<%= (rel ? (rel + '/' + e.name) : e.name) %>">Download</a>
                  <% } %>
                  <form method="post" action="/admin/files/rename" class="inline">
                    <input type="hidden" name="p" value="<%= rel %>" />
                    <input type="hidden" name="old" value="<%= e.name %>" />
                    <input class="input small" type="text" name="next" placeholder="New name" />
                    <button class="btn btn-outline">Rename</button>
                  </form>
                  <form method="post" action="/admin/files/delete" class="inline">
                    <input type="hidden" name="p" value="<%= rel %>" />
                    <input type="hidden" name="name" value="<%= e.name %>" />
                    <button class="btn btn-danger">Delete</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } %>
    </div>
  </main>
  <script src="/public/js/ui.js"></script>
</body>
</html>
